<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <style>
        html,
        body,
        #container {
            width: 100%;
            height: 100%;
        }
    </style>
    <title>GeoJSON</title>
    <!-- <link rel="stylesheet" href="//a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css" /> -->
    <script src="https://webapi.amap.com/maps?v=1.4.11&key=19b6ffb41d6c37ad488f0d57088e2ebd"></script>
    <script src="https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js"></script>
    <script src="./jquery-3.3.1.min.js"></script>
    <script src="./com.js"></script>
</head>

<body>
    <div id="container"></div>
    <script type="text/javascript">
        $.ajax({
            type: "GET",
            url: 'https://kybcrm-files.oss-cn-hangzhou.aliyuncs.com/prod/tesla/smart-scenic-v2-web/amcharts/1.json',
            async: true,
            contentType: "application/json",
            dataType: "json",
            success: ((geoJSON) => {
                const length = geoJSON.features.length;
                console.log(length)
                // let a = 0;
                // geoJSON.features.map(v => {
                //     AMap.convertFrom(v.geometry.coordinates, 'gps', function (status, result) {
                //         if (result.info === 'ok') {
                //             var lnglats = result.locations; // Array.<LngLat>
                //             v.geometry.coordinates = lnglats;
                //               a++;
                //         }
                //          if (status== 'complete') {
                //             a++;
                //          }
                //     });
                // })


                // const timer = setInterval(() => {
                //     if (length <= a) {
                //         console.log(a, geoJSON.features)

                //         clearInterval(timer)
                //     }
                // }, 500)
                // console.log(3)
                // console.log(geojson)

                // geojson.setMap(map);
                // console.log('GeoJSON 数据加载完成')

                // var markerContent = '' +
                //     '<div class="custom-content-marker">' +
                //     ' <img src="//a.amap.com/jsapi_demos/static/demo-center/icons/dir-via-marker.png">' +
                //     ' <div class="close-btn" onclick="clearMarker()">X</div>' +
                //     '</div>';
                var geojson = new AMap.GeoJSON({
                    geoJSON: geoJSON,
                    getMarker: (geojson, lnglats) => {
                        if (geojson.properties && geojson.properties.name) {

                            // const marker = _marker(lnglats, startIcon);
                            const marker = new AMap.Marker({
                                position: lnglats,
                                icon: startIcon, // 添加 Icon 实例
                                offset: new AMap.Pixel(-13, -30),
                            })

                            // //创建右键菜单
                            // var contextMenu = new AMap.ContextMenu();

                            // //右键放大
                            // contextMenu.addItem("放大一级", function () {
                            //     map.zoomIn();
                            // }, 0);

                            // //右键缩小
                            // contextMenu.addItem("缩小一级", function () {
                            //     map.zoomOut();
                            // }, 1);
                            AMap.event.addListener(marker, 'click', (geojson) => {
                                console.log(geojson)
                                // contextMenu.open(map, e.lnglat);
                            });
                            return marker;
                        }
                        return;
                    }
                });

                geojson.setMap(map);
                console.log('GeoJSON 数据加载完成')
            }),
            fail: ((err) => {
                console.log(err)
            })
        });
    </script>
</body>

</html>